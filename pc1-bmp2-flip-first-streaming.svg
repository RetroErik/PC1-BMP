<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 810" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <!-- Background texture gradient -->
    <radialGradient id="bgGrad" cx="50%" cy="50%" r="70%">
      <stop offset="0%" stop-color="#1a3a5c"/>
      <stop offset="100%" stop-color="#0a1a2e"/>
    </radialGradient>
    <!-- Gold gradient for borders -->
    <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#d4a020"/>
      <stop offset="30%" stop-color="#f0d060"/>
      <stop offset="50%" stop-color="#ffe880"/>
      <stop offset="70%" stop-color="#f0d060"/>
      <stop offset="100%" stop-color="#d4a020"/>
    </linearGradient>
    <!-- Gold gradient for title bar -->
    <linearGradient id="titleGold" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#a07010"/>
      <stop offset="20%" stop-color="#d4a020"/>
      <stop offset="50%" stop-color="#ffe880"/>
      <stop offset="80%" stop-color="#d4a020"/>
      <stop offset="100%" stop-color="#a07010"/>
    </linearGradient>
    <!-- Beam arrow gradient -->
    <linearGradient id="beamGrad" x1="0%" y1="50%" x2="100%" y2="50%">
      <stop offset="0%" stop-color="#d4a020"/>
      <stop offset="100%" stop-color="#ffe880"/>
    </linearGradient>
    <!-- Grid pattern for background texture -->
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <rect width="20" height="20" fill="none"/>
      <line x1="20" y1="0" x2="20" y2="20" stroke="#ffffff08" stroke-width="0.5"/>
      <line x1="0" y1="20" x2="20" y2="20" stroke="#ffffff08" stroke-width="0.5"/>
    </pattern>
    <!-- Scanline bar gradient (dark) -->
    <linearGradient id="barDark" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#1a1a2a"/>
      <stop offset="100%" stop-color="#2a2a3a"/>
    </linearGradient>
    <!-- Drop shadow filter -->
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#00000080"/>
    </filter>
    <!-- Glow for title -->
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge>
        <feMergeNode in="blur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <!-- Arrow markers -->
    <marker id="arrowGold" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#d4a020"/>
    </marker>
    <marker id="arrowRed" markerWidth="8" markerHeight="6" refX="4" refY="3" orient="auto" fill="#ff4444">
      <polygon points="0 0, 8 3, 0 6"/>
    </marker>
  </defs>

  <!-- ==================== BACKGROUND ==================== -->
  <rect width="1100" height="810" fill="url(#bgGrad)"/>
  <rect width="1100" height="810" fill="url(#grid)"/>

  <!-- ==================== OUTER GOLD BORDER ==================== -->
  <rect x="15" y="15" width="1070" height="780" rx="8" ry="8"
        fill="none" stroke="url(#goldGrad)" stroke-width="4"/>
  <rect x="22" y="22" width="1056" height="766" rx="6" ry="6"
        fill="none" stroke="#d4a02060" stroke-width="1"/>

  <!-- Corner ornaments -->
  <circle cx="15" cy="15" r="6" fill="#d4a020" opacity="0.6"/>
  <circle cx="1085" cy="15" r="6" fill="#d4a020" opacity="0.6"/>
  <circle cx="15" cy="795" r="6" fill="#d4a020" opacity="0.6"/>
  <circle cx="1085" cy="795" r="6" fill="#d4a020" opacity="0.6"/>

  <!-- ==================== TITLE BAR ==================== -->
  <rect x="200" y="30" width="700" height="42" rx="4" fill="#0a1a2e" stroke="url(#titleGold)" stroke-width="2"/>
  <line x1="200" y1="30" x2="900" y2="30" stroke="url(#titleGold)" stroke-width="2"/>
  <text x="550" y="58" text-anchor="middle" font-size="24" font-weight="bold"
        fill="url(#titleGold)" filter="url(#glow)" font-variant="small-caps"
        letter-spacing="3">PC1-BMP2: Flip-First Palette Streaming</text>
  <!-- Decorative lines -->
  <line x1="220" y1="68" x2="880" y2="68" stroke="#d4a02040" stroke-width="1"/>

  <!-- ================================================================ -->
  <!-- EVEN SCANLINE PANEL                                              -->
  <!-- ================================================================ -->
  <rect x="45" y="85" width="1010" height="265" rx="6" fill="#0d1f35" stroke="url(#goldGrad)" stroke-width="2.5" opacity="0.95"/>

  <!-- HBLANK / VISIBLE AREA labels -->
  <text x="270" y="112" text-anchor="middle" font-size="15" fill="#cccccc" font-weight="bold" letter-spacing="2">HBLANK</text>
  <line x1="120" y1="118" x2="408" y2="118" stroke="#ffffff30" stroke-width="1"/>
  <text x="720" y="112" text-anchor="middle" font-size="15" fill="#cccccc" font-weight="bold" letter-spacing="2">VISIBLE AREA</text>
  <line x1="425" y1="118" x2="960" y2="118" stroke="#ffffff30" stroke-width="1"/>

  <!-- EVEN SCANLINE label -->
  <text x="62" y="162" font-size="18" fill="#ffffff" font-weight="bold">EVEN</text>
  <text x="62" y="180" font-size="12" fill="#aaaaaa">SCANLINE</text>
  <text x="62" y="196" font-size="10" fill="#d4a020" font-style="italic">Flip → Pal 1</text>

  <!-- Scanline bar background -->
  <rect x="120" y="140" width="910" height="48" rx="5" fill="url(#barDark)" stroke="#444455" stroke-width="1.5"/>

  <!-- HBLANK boundary marker (~80 cycles: FLIP+OPEN+E2+E3 done, E4 straddles boundary) -->
  <line x1="416" y1="130" x2="416" y2="195" stroke="#ffffff40" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- FLIP box -->
  <rect x="130" y="148" width="50" height="32" rx="4" fill="#4CAF50" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="155" y="169" text-anchor="middle" font-size="13" fill="white" font-weight="bold">FLIP</text>

  <!-- Small arrow after FLIP -->
  <polygon points="184,164 190,160 190,168" fill="#d4a020"/>

  <!-- OPEN box -->
  <rect x="194" y="148" width="46" height="32" rx="4" fill="#4CAF50" stroke="#388E3C" stroke-width="1.5"/>
  <text x="217" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OPEN</text>

  <!-- Small arrow after OPEN -->
  <polygon points="244,164 250,160 250,168" fill="#d4a020"/>

  <!-- 12 OUT boxes (OUTSB operations) — color-coded by register -->
  <!-- E2: 2 bytes — Upcoming (inactive Pal 0, pre-loaded with line N+2) -->
  <rect x="254" y="148" width="38" height="32" rx="3" fill="#e6a800" stroke="#b38600" stroke-width="1"/>
  <text x="273" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="295" y="148" width="38" height="32" rx="3" fill="#e6a800" stroke="#b38600" stroke-width="1"/>
  <text x="314" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E3: 2 bytes — Current (active Pal 1, passthrough same value) -->
  <rect x="336" y="148" width="38" height="32" rx="3" fill="#e05050" stroke="#b03030" stroke-width="1"/>
  <text x="355" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="377" y="148" width="38" height="32" rx="3" fill="#e05050" stroke="#b03030" stroke-width="1"/>
  <text x="396" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E4: 2 bytes — Upcoming -->
  <rect x="418" y="148" width="38" height="32" rx="3" fill="#3080d0" stroke="#2060a0" stroke-width="1"/>
  <text x="437" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="459" y="148" width="38" height="32" rx="3" fill="#3080d0" stroke="#2060a0" stroke-width="1"/>
  <text x="478" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E5: 2 bytes — Current -->
  <rect x="500" y="148" width="38" height="32" rx="3" fill="#9040b0" stroke="#7030a0" stroke-width="1"/>
  <text x="519" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="541" y="148" width="38" height="32" rx="3" fill="#9040b0" stroke="#7030a0" stroke-width="1"/>
  <text x="560" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E6: 2 bytes — Upcoming (in visible area — but INACTIVE = safe) -->
  <rect x="582" y="148" width="38" height="32" rx="3" fill="#20a060" stroke="#108040" stroke-width="1"/>
  <text x="601" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="623" y="148" width="38" height="32" rx="3" fill="#20a060" stroke="#108040" stroke-width="1"/>
  <text x="642" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E7: 2 bytes — Current (passthrough, in visible area, same value = safe) -->
  <rect x="664" y="148" width="38" height="32" rx="3" fill="#d06820" stroke="#a05010" stroke-width="1"/>
  <text x="683" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="705" y="148" width="38" height="32" rx="3" fill="#d06820" stroke="#a05010" stroke-width="1"/>
  <text x="724" y="169" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- CLOSE box -->
  <rect x="753" y="148" width="55" height="32" rx="4" fill="#d4a020" stroke="#b38600" stroke-width="1.5"/>
  <text x="780" y="169" text-anchor="middle" font-size="13" fill="white" font-weight="bold">CLOSE</text>

  <!-- Register labels beneath OUT pairs -->
  <text x="294" y="199" text-anchor="middle" font-size="12" fill="#e6a800" font-weight="bold">E2</text>
  <text x="376" y="199" text-anchor="middle" font-size="12" fill="#e05050" font-weight="bold">E3</text>
  <text x="458" y="199" text-anchor="middle" font-size="12" fill="#3080d0" font-weight="bold">E4</text>
  <text x="540" y="199" text-anchor="middle" font-size="12" fill="#9040b0" font-weight="bold">E5</text>
  <text x="622" y="199" text-anchor="middle" font-size="12" fill="#20a060" font-weight="bold">E6</text>
  <text x="704" y="199" text-anchor="middle" font-size="12" fill="#d06820" font-weight="bold">E7</text>

  <!-- Beam arrow in visible area -->
  <line x1="820" y1="164" x2="1010" y2="164" stroke="url(#beamGrad)" stroke-width="3" marker-end="url(#arrowGold)"/>
  <!-- Speed lines -->
  <line x1="980" y1="156" x2="1020" y2="156" stroke="#d4a02060" stroke-width="1"/>
  <line x1="985" y1="160" x2="1025" y2="160" stroke="#d4a02040" stroke-width="1"/>
  <line x1="980" y1="168" x2="1020" y2="168" stroke="#d4a02060" stroke-width="1"/>
  <line x1="985" y1="172" x2="1025" y2="172" stroke="#d4a02040" stroke-width="1"/>

  <!-- ===== CURRENT / UPCOMING ANNOTATIONS ===== -->

  <!-- Down arrows from all 6 registers -->
  <line x1="294" y1="205" x2="294" y2="235" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="376" y1="205" x2="376" y2="235" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="458" y1="205" x2="458" y2="235" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="540" y1="205" x2="540" y2="235" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="622" y1="205" x2="622" y2="235" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="704" y1="205" x2="704" y2="235" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>

  <!-- Per-register current/upcoming labels -->
  <text x="294" y="250" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>
  <text x="376" y="250" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>
  <text x="458" y="250" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>
  <text x="540" y="250" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>
  <text x="622" y="250" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>
  <text x="704" y="250" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>

  <!-- Legend: Current explanation -->
  <rect x="160" y="264" width="12" height="12" rx="2" fill="#e6a800" opacity="0.8"/>
  <text x="178" y="275" font-size="12" fill="#e6a800" font-weight="bold">E3, E5, E7: Current</text>
  <text x="178" y="290" font-size="11" fill="#aaaaaa" font-style="italic">Active (Pal 1) — passthrough: same value rewritten — no flicker</text>

  <!-- Legend: Upcoming explanation -->
  <rect x="160" y="304" width="12" height="12" rx="2" fill="#50ff80" opacity="0.8"/>
  <text x="178" y="315" font-size="12" fill="#50ff80" font-weight="bold">E2, E4, E6: Upcoming</text>
  <text x="178" y="330" font-size="11" fill="#aaaaaa" font-style="italic">Inactive (Pal 0) — pre-loaded with line N+2 colors — safe in any column</text>

  <!-- 15 OUTs / ~159 cycles annotation -->
  <text x="760" y="210" font-size="11" fill="#888888">15 OUTs · ~159 cycles</text>
  <text x="760" y="226" font-size="11" fill="#666666">FLIP + OPEN + OUTSB×12 + CLOSE</text>

  <!-- ================================================================ -->
  <!-- ODD SCANLINE PANEL                                               -->
  <!-- ================================================================ -->
  <rect x="45" y="370" width="1010" height="265" rx="6" fill="#0d1f35" stroke="url(#goldGrad)" stroke-width="2.5" opacity="0.95"/>

  <!-- HBLANK / VISIBLE AREA labels -->
  <text x="270" y="397" text-anchor="middle" font-size="15" fill="#cccccc" font-weight="bold" letter-spacing="2">HBLANK</text>
  <line x1="120" y1="403" x2="408" y2="403" stroke="#ffffff30" stroke-width="1"/>
  <text x="720" y="397" text-anchor="middle" font-size="15" fill="#cccccc" font-weight="bold" letter-spacing="2">VISIBLE AREA</text>
  <line x1="425" y1="403" x2="960" y2="403" stroke="#ffffff30" stroke-width="1"/>

  <!-- ODD SCANLINE label -->
  <text x="62" y="447" font-size="18" fill="#ffffff" font-weight="bold">ODD</text>
  <text x="62" y="465" font-size="12" fill="#aaaaaa">SCANLINE</text>
  <text x="62" y="481" font-size="10" fill="#d4a020" font-style="italic">Flip → Pal 0</text>

  <!-- Scanline bar background -->
  <rect x="120" y="425" width="910" height="48" rx="5" fill="url(#barDark)" stroke="#444455" stroke-width="1.5"/>

  <!-- HBLANK boundary marker (~80 cycles: E4 straddles boundary) -->
  <line x1="416" y1="415" x2="416" y2="480" stroke="#ffffff40" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- FLIP box (pink for odd) -->
  <rect x="130" y="433" width="50" height="32" rx="4" fill="#e91e63" stroke="#c2185b" stroke-width="1.5"/>
  <text x="155" y="454" text-anchor="middle" font-size="13" fill="white" font-weight="bold">FLIP</text>

  <!-- Small arrow after FLIP -->
  <polygon points="184,449 190,445 190,453" fill="#d4a020"/>

  <!-- OPEN box -->
  <rect x="194" y="433" width="46" height="32" rx="4" fill="#4CAF50" stroke="#388E3C" stroke-width="1.5"/>
  <text x="217" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OPEN</text>

  <!-- Small arrow after OPEN -->
  <polygon points="244,449 250,445 250,453" fill="#d4a020"/>

  <!-- 12 OUT boxes — SAME register colors, SWAPPED Current/Upcoming roles -->
  <!-- E2: 2 bytes — Current (active Pal 0, passthrough) -->
  <rect x="254" y="433" width="38" height="32" rx="3" fill="#e6a800" stroke="#b38600" stroke-width="1"/>
  <text x="273" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="295" y="433" width="38" height="32" rx="3" fill="#e6a800" stroke="#b38600" stroke-width="1"/>
  <text x="314" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E3: 2 bytes — Upcoming (inactive Pal 1, pre-loaded) -->
  <rect x="336" y="433" width="38" height="32" rx="3" fill="#e05050" stroke="#b03030" stroke-width="1"/>
  <text x="355" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="377" y="433" width="38" height="32" rx="3" fill="#e05050" stroke="#b03030" stroke-width="1"/>
  <text x="396" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E4: 2 bytes — Current -->
  <rect x="418" y="433" width="38" height="32" rx="3" fill="#3080d0" stroke="#2060a0" stroke-width="1"/>
  <text x="437" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="459" y="433" width="38" height="32" rx="3" fill="#3080d0" stroke="#2060a0" stroke-width="1"/>
  <text x="478" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E5: 2 bytes — Upcoming -->
  <rect x="500" y="433" width="38" height="32" rx="3" fill="#9040b0" stroke="#7030a0" stroke-width="1"/>
  <text x="519" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="541" y="433" width="38" height="32" rx="3" fill="#9040b0" stroke="#7030a0" stroke-width="1"/>
  <text x="560" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E6: 2 bytes — Current (passthrough, in visible, same value = safe) -->
  <rect x="582" y="433" width="38" height="32" rx="3" fill="#20a060" stroke="#108040" stroke-width="1"/>
  <text x="601" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="623" y="433" width="38" height="32" rx="3" fill="#20a060" stroke="#108040" stroke-width="1"/>
  <text x="642" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- E7: 2 bytes — Upcoming (inactive, in visible, not displayed = safe) -->
  <rect x="664" y="433" width="38" height="32" rx="3" fill="#d06820" stroke="#a05010" stroke-width="1"/>
  <text x="683" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>
  <rect x="705" y="433" width="38" height="32" rx="3" fill="#d06820" stroke="#a05010" stroke-width="1"/>
  <text x="724" y="454" text-anchor="middle" font-size="11" fill="white" font-weight="bold">OUT</text>

  <!-- CLOSE box -->
  <rect x="753" y="433" width="55" height="32" rx="4" fill="#d4a020" stroke="#b38600" stroke-width="1.5"/>
  <text x="780" y="454" text-anchor="middle" font-size="13" fill="white" font-weight="bold">CLOSE</text>

  <!-- Register labels beneath OUT pairs -->
  <text x="294" y="484" text-anchor="middle" font-size="12" fill="#e6a800" font-weight="bold">E2</text>
  <text x="376" y="484" text-anchor="middle" font-size="12" fill="#e05050" font-weight="bold">E3</text>
  <text x="458" y="484" text-anchor="middle" font-size="12" fill="#3080d0" font-weight="bold">E4</text>
  <text x="540" y="484" text-anchor="middle" font-size="12" fill="#9040b0" font-weight="bold">E5</text>
  <text x="622" y="484" text-anchor="middle" font-size="12" fill="#20a060" font-weight="bold">E6</text>
  <text x="704" y="484" text-anchor="middle" font-size="12" fill="#d06820" font-weight="bold">E7</text>

  <!-- Beam arrow in visible area -->
  <line x1="820" y1="449" x2="1010" y2="449" stroke="url(#beamGrad)" stroke-width="3" marker-end="url(#arrowGold)"/>
  <!-- Speed lines -->
  <line x1="980" y1="441" x2="1020" y2="441" stroke="#d4a02060" stroke-width="1"/>
  <line x1="985" y1="445" x2="1025" y2="445" stroke="#d4a02040" stroke-width="1"/>
  <line x1="980" y1="453" x2="1020" y2="453" stroke="#d4a02060" stroke-width="1"/>
  <line x1="985" y1="457" x2="1025" y2="457" stroke="#d4a02040" stroke-width="1"/>

  <!-- ===== CURRENT / UPCOMING — SWAPPED vs EVEN ===== -->

  <!-- Down arrows from all 6 registers -->
  <line x1="294" y1="490" x2="294" y2="520" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="376" y1="490" x2="376" y2="520" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="458" y1="490" x2="458" y2="520" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="540" y1="490" x2="540" y2="520" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="622" y1="490" x2="622" y2="520" stroke="#e6a800" stroke-width="2" marker-end="url(#arrowRed)"/>
  <line x1="704" y1="490" x2="704" y2="520" stroke="#ff4444" stroke-width="2" marker-end="url(#arrowRed)"/>

  <!-- Per-register current/upcoming labels — SWAPPED -->
  <text x="294" y="535" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>
  <text x="376" y="535" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>
  <text x="458" y="535" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>
  <text x="540" y="535" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>
  <text x="622" y="535" text-anchor="middle" font-size="10" fill="#e6a800" font-style="italic">Current</text>
  <text x="704" y="535" text-anchor="middle" font-size="10" fill="#50ff80" font-style="italic">Upcoming</text>

  <!-- Legend: Current explanation — roles SWAPPED -->
  <rect x="160" y="549" width="12" height="12" rx="2" fill="#e6a800" opacity="0.8"/>
  <text x="178" y="560" font-size="12" fill="#e6a800" font-weight="bold">E2, E4, E6: Current</text>
  <text x="178" y="575" font-size="11" fill="#aaaaaa" font-style="italic">Active (Pal 0) — passthrough: same value rewritten — no flicker</text>

  <!-- Legend: Upcoming explanation -->
  <rect x="160" y="589" width="12" height="12" rx="2" fill="#50ff80" opacity="0.8"/>
  <text x="178" y="600" font-size="12" fill="#50ff80" font-weight="bold">E3, E5, E7: Upcoming</text>
  <text x="178" y="615" font-size="11" fill="#aaaaaa" font-style="italic">Inactive (Pal 1) — pre-loaded with line N+2 colors — safe in any column</text>

  <!-- 15 OUTs / ~159 cycles annotation -->
  <text x="760" y="500" font-size="11" fill="#888888">15 OUTs · ~159 cycles</text>
  <text x="760" y="516" font-size="11" fill="#666666">Same code path, swapped data</text>

  <!-- ================================================================ -->
  <!-- WHY NO FLICKER PANEL (bottom)                                    -->
  <!-- ================================================================ -->
  <rect x="45" y="655" width="1010" height="110" rx="6" fill="#0d1f35" stroke="url(#goldGrad)" stroke-width="2.5" opacity="0.95"/>

  <!-- Panel label -->
  <rect x="60" y="662" width="330" height="22" rx="3" fill="#d4a02015" stroke="#d4a02050" stroke-width="1"/>
  <text x="225" y="677" text-anchor="middle" font-size="13" fill="#d4a020" font-weight="bold" letter-spacing="1">WHY NO FLICKER? (vs CGAFLIP9)</text>

  <!-- Point 1: Upcoming = inactive -->
  <circle cx="80" cy="700" r="5" fill="#50ff80"/>
  <text x="95" y="704" font-size="12" fill="#50ff80" font-weight="bold">UPCOMING — NOT DISPLAYED:</text>
  <text x="310" y="704" font-size="11" fill="#aaaaaa">Inactive entries are invisible. Writing them in the visible area causes zero artifacts.</text>

  <!-- Point 2: Current = passthrough -->
  <circle cx="80" cy="725" r="5" fill="#e6a800"/>
  <text x="95" y="729" font-size="12" fill="#e6a800" font-weight="bold">CURRENT — SAME VALUE:</text>
  <text x="290" y="729" font-size="11" fill="#aaaaaa">Active entries receive the exact same value → no color change → no flicker.</text>
  <text x="290" y="744" font-size="11" fill="#aaaaaa">In cgaflip9, active entries receive NEW values → column order constraint to avoid flicker.</text>

  <!-- Point 3: Result -->
  <circle cx="80" cy="755" r="5" fill="#d4a020"/>
  <text x="95" y="759" font-size="12" fill="#d4a020" font-weight="bold">RESULT:</text>
  <text x="155" y="759" font-size="11" fill="#aaaaaa">Any color at any pixel position — no column constraint — essential for arbitrary BMP images.</text>

  <!-- ==================== FOOTER ==================== -->
  <line x1="100" y1="778" x2="1000" y2="778" stroke="#d4a02030" stroke-width="1"/>
  <text x="550" y="795" text-anchor="middle" font-size="11" fill="#555555">
    Olivetti Prodest PC1 · Yamaha V6355D · NEC V40 @ 8 MHz · CGA Mode 4 · Flip-First / Inactive-Only Pattern
  </text>
  <text x="1070" y="795" text-anchor="end" font-size="10" fill="#d4a02080" font-style="italic">Illustration by Retro Erik</text>

</svg>
